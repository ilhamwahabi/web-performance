import Img from "./components/Image";
import Layout from "./components/Layout";
import Link from "./components/Link";
import { themes } from "mdx-deck";
import { dark } from '@mdx-deck/themes'

export const theme = dark;

<Layout>

# How to Build High Performance Website

by Ilham Wahabi

</Layout>

---

# About Me

<Steps>

- Frontend Developer
- Informatics ITB'16
- Ex. eHealth, Dekoruma, Chatbiz, Stoqo
- <Link href="https://github.com/iwgx">Github</Link> & <Link href="https://twitter.com/ilhamwahabigx">Twitter</Link>

</Steps>

---

# bad found

---

<Layout>

> Aberdeen Group found that a **1s slow down** resulted **11% fewer page views**, **7% less conversion**

</Layout>

---

<Layout>

> Akamai found that **2s delay** in web page load time increase **bounce rates by 103%**

</Layout>

---

<Layout>

> Google found that a **2% slower page** resulted in **2% fewer searches**, which means 2% fewer ads show

</Layout>

---

# good found

---

<Layout>

> A **400ms improvement** in performance resulted in a **9% increase in traffic** at Yahoo

</Layout>

---

<Layout>

> **100ms improvement** in performance results in **1% increase in overall revenue** at Amazon

</Layout>

---

# Takeaways

<Steps>

### Even small improvement have huge affect

</Steps>

---

<Invert>

# 3 Aspect of Performance

<Steps>

### Javascript

### Load

### Rendering

</Steps>

</Invert>

---

# Steve Golden Rules of Performance

---

## Doing less stuff takes less time

---

## If you can do it later. Do it later

---

# Javascript Performance

---

<Img alt="" src={require("./images/js.png")} />

---

# Try avoid nested function

```js
function cubic(a) {
  // Will parse repeatedly
  function square(b) {
    return b * b;
  };

  return square(a) \* a;
}
```

---

# Use function consistently

```js
function add(a, b) {
  return a + b;
}

add(1, 2);

add(2, 3); // faster

add("1", "a"); // slower
```

---

# Takeaways

<Steps>

- Ship less code

- Consider type system

</Steps>

---

## Debugging with worsen performance

<Img
  alt=""
  src={require("./images/network.png")}
  style={{ width: "60%", maxWidth: 1080 }}
/>

---

## Benchmark Javascript Operation with <Link href="https://perf.link/">perf.link</Link>

<Img alt="" src={require("./images/perflink.png")} />

---

# Load Performance

---

## Debugging with slow connection

<Img alt="" src={require("./images/network.png")} />

---

## Code splitting

---

## Imagine this scenario

<Steps>

1. Your website have *home page*, *about page*, and *register page*

2. User visit your *home page*

3. Is user also need to load your *about page* & *register page*?

</Steps>

---

<Invert>

## Just load what matters

<Img alt="" src={require("./images/codesplitting.png")} />

</Invert>

---

## 2 types:

<Steps>

1. Route based
   - Split route that likely will not visited often
   - Ex: Split login page and dashboard page

2. Component based
   - Split component that will not use immediately
   - Ex: Split modal and drawer

</Steps>

---

```js
// load even if user will not use
import Modal from "./Modal.vue";

// just load when used
const Modal = () => import("./Modal.vue");
```

---

### Nuxt use route-based code splitting as default

<Img alt="" src={require("./images/nuxt.png")} />

---

## This is JUST (modern) Javascript

---

# Load Img

---

## Keep small

<Steps>

## and

## Just load what screen need

</Steps>

---

```html
<img src="small.jpg" srcset="medium.jpg 500w, large.jpg 1000w" />
```

<Steps>

- If your device width is 320px
- And non retina (1x)
- Calculation:
  - 500 / 320 = 1.5625
  - 1000 / 320 = 3.125
- Then your browser will choose **medium.jpg**
- Since it nearest >= than 1

</Steps>

---

- You need multiple file for one image

<Steps>

- You need to compress it manually

</Steps>

---

## <Link href="https://www.imgix.com/">Imgix</Link>

<Img alt="" src={require("./images/imgix.png")} />

---

### http://domain/img.png?auto=compress&w=600&h=400

<Steps>

- Just need 1 master file

- No need compress manually

- And another great feature!

- <Link href="https://github.com/imgix/vue-imgix">vue-imgix</Link>

</Steps>

---

# How to check package size?

---

# <Link href="https://bundlephobia.com/">Bundlephobia</Link>

<Img alt="" src={require("./images/bundlephobia.png")} />

---

# Alternative package

<Steps>

take with grain of salt

</Steps>

---

## dayjs, for momentjs

---

## redaxios, for axios

---

## nanoid, for uuid

---

## lodash-es, for lodash

<Steps>

even better

## lodash.[methodName]

</Steps>

---

## Or use it with

<Steps>

```js
import add from "lodash/add";

add(6, 4);
```

</Steps>

---

# Render Performance

---

# Reflow

<Steps>

- Blocking operation

- Consume CPU

</Steps>

---

Whenever the geometry of an element changes, the browser has to reflow the page

Reflow an element causes a reflow of its parent and children

---

## Cause

<Steps>

- Changing the font
- Content changes
- Add / remove element
- Add / remove classes
- Calculating size
- Changing size / position
- (Even more...)

</Steps>

---

## How to Avoid?

- Change classes at the lowest level

- Avoid repeatedly modifying inline style

- Avoid table layouts

- (Even more...)

---

## Do Batch DOM Manipulation

<Steps>

```js
// BAD
parent.append(child1);
parent.append(child2);
```

```js
// GOOD
fragment.append(child1);
fragment.append(child2);

parent.append(fragment);
```

</Steps>

---

## Layout Trashing

---

we **update** something

<Steps>

then we **read** something

browser be like

#### wait, you just changed something before. Let me reflow the page again

</Steps>

---

```js
// BAD
const width1 = element1.offsetWidth;
element1.style.width = width1 * 2;

const width2 = element2.offsetWidth;
element1.style.width = width2 * 2;
```

<Steps>

```js
// GOOD
const width1 = element1.offsetWidth;
const width2 = element2.offsetWidth;

element1.style.width = width1 * 2;
element2.style.width = width2 * 2;
```

</Steps>

---

# Solution

<Steps>

### Separate read and write

</Steps>

---

If you can change the visual appearance of an element by adding a **CSS class**

Do that, you'll avoid accidental trashing

---

# Have long list of data?

<Img alt="" src={require("./images/twitter.png")} />

---

## Every time you scroll a long list

<Steps>

#### There is expensive DOM nodes creation

### and

#### Not-visible component still stored in memory

</Steps>

---

## Use <Link href="https://github.com/tangbc/vue-virtual-scroll-list">vue-virtual-scroll-list</Link>

<Steps>

- By Vue core team
- only renders the visible items
- as the user scrolls,
- it reuses all components & DOM nodes

</Steps>

---

<Invert>

# But, hey! Maybe you don't need this?

<Steps>

## How about pagination?

</Steps>

</Invert>

---

# Audit

---

# It's an irony

---

# User access our web...

<Steps>

## Using low spec device

## In slow connection

</Steps>

---

<Invert>

# Meanwhile developer...

<Steps>

## Using high spec device

## In high speed connection

</Steps>

</Invert>

---

# Auditing Tools

---

## 1. <Link href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">Lighthouse</Link>

<Img alt="" src={require("./images/lighthouse.png")} />

---

## 2. <Link href="https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma">Web Vitals</Link>

<Img alt="" src={require("./images/webvitals.png")} />

---

## 3. <Link href="https://web.dev/measure/">Measure</Link>

<Img alt="" src={require("./images/measure.png")} />

---

## 4. <Link href="https://developers.google.com/speed/pagespeed/insights/">Pagespeed Insight</Link>

<Img alt="" src={require("./images/pagespeedinsight.png")} />

---

## 5. <Link href="https://testmysite.io/">Testmysite</Link>

<Img alt="" src={require("./images/testmysite.png")} />

---

## 6. <Link href="https://www.webpagetest.org/">Webpagetest</Link>

<Img alt="" src={require("./images/webpagetest.png")} />

---

# It's Audit Time!

---

## Things not discussed here

- Animate CSS with performance
- Load font effectively
- Caching
- Service Worker
- Unused code removal
- Much more...

---

## That's all folks

# Any Question?
